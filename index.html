<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SSR Tennis Tournament 2026</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
*{box-sizing:border-box}
body{
 margin:0;
 background:white;
 color:black;
 font-family:Arial,Helvetica,sans-serif;
 overflow:hidden;
}

/* HEADER */
.header{
 display:grid;
 grid-template-columns:auto 1fr auto;
 align-items:center;
 padding:12px 30px;
 font-size:2.2vw;
 font-weight:900;
 color:#000080;
 border-bottom:4px solid #00ffd5;
}
.header div:nth-child(2){text-align:center;}
.balls{font-size:2.8vw}

/* COURT */
.main{display:flex;height:72vh}
.team{
 flex:1;
 border:4px solid #00ffd5;
 margin:8px;
 padding:16px;
 text-align:center;
 display:flex;
 flex-direction:column;
 transition:all .6s ease;
}

/* NAME + SERVE */
.nameRow{
 display:flex;
 align-items:center;
 justify-content:center;
 gap:12px;
}

.name{
 font-size:5.5vw;
 font-weight:900;
 color:#000080;
 cursor:pointer;
}

.server{
 font-size:2.8vw;
 min-width:3vw;
 text-align:center;
 opacity:0;
}

/* SERVE ANIMATION */
.server.active{
 opacity:1;
 animation:serveBounce 1s infinite alternate;
}

@keyframes serveBounce{
 from{transform:translateY(0)}
 to{transform:translateY(-8px)}
}

/* SCORE */
.score{
 flex:1;
 display:flex;
 align-items:center;
 justify-content:center;
 text-align:center;
 font-weight:900;
 cursor:pointer;
 white-space:pre-line;
 padding:10px;
 font-size:clamp(6vw,18vw,22vw);
 line-height:1;
 color:red;
}

/* UNDO */
.undo{
 font-size:2vw;
 margin-top:6px;
 color:#ff5555;
 cursor:pointer;
 opacity:0.8;
}
.undo:hover{transform:scale(1.2);opacity:1}

.games{font-size:3.2vw;color:#000080;font-weight:900;text-shadow:1px 1px 2px rgba(0,0,0,0.3);}

/* EFFECTS */
.golden{
 font-size:clamp(4vw,10vw,12vw);
 color:gold;
 font-weight:900;
 animation:wobble .6s infinite alternate;
}
@keyframes wobble{from{transform:rotate(-2deg)}to{transform:rotate(2deg)}}

.winner{
 background:#003300;
 box-shadow:0 0 80px #00ff00;
}
.winner .name{
 color:white !important;
}
.winnersText{
 font-size:10vw;
 color:gold;
 animation:flash 1s infinite alternate;
}

@keyframes flash{from{opacity:.6}to{opacity:1}}

/* CONTROLS */
.controls{text-align:center}
button{
 font-size:1.4vw;
 padding:6px 14px;
 font-weight:bold;
 cursor:pointer;
}
#goldenGameBanner{
 font-size:2.8vw;
 font-weight:900;
 color:gold;
 display:none;
 animation:wobble .7s infinite alternate;
}
.nextMatch{font-size:2.8vw;color:#000080;font-weight:900;text-shadow:1px 1px 2px rgba(0,0,0,0.3);margin-top:6px}

/* BOTTOM */
.bottomLeft{
 position:fixed;
 bottom:8px;
 left:8px;
 display:flex;
 gap:8px;
}

/* ICON BUTTONS */
.iconBtn{
 position:fixed;
 bottom:20px;
 right:20px;
 font-size:2.5vw;
 background:gold;
 color:black;
 border:none;
 width:55px;
 height:55px;
 border-radius:50%;
 cursor:pointer;
 box-shadow:0 0 20px gold;
 margin-left:10px;
 display:inline-flex;
 align-items:center;
 justify-content:center;
}
.nextIcon{right:90px;background:red;color:white;box-shadow:0 0 20px red;}
.resultsIcon{right:20px;}

/* AUDIENCE MODE ICON */
.audienceIcon{
 position:fixed;
 top:20px;
 right:20px;
 font-size:2.5vw;
 background:#00ffd5;
 color:black;
 border:none;
 width:55px;
 height:55px;
 border-radius:50%;
 cursor:pointer;
 box-shadow:0 0 20px #00ffd5;
 display:inline-flex;
 align-items:center;
 justify-content:center;
 z-index:50;
 transition: all 0.3s ease;
}
.audienceIcon.active{
 background:gold;
 box-shadow:0 0 20px gold;
 transform: rotate(180deg);
}

/* RESULTS OVERLAY - UPDATED TO WHITE BG WITH RED TEXT */
#resultsOverlay{
 position:fixed;
 top:0;
 left:0;
 width:100vw;
 height:100vh;
 background:white;
 display:none;
 z-index:200;
 overflow-y:auto;
 padding:20px;
 color:red;
}
.resultsHeader{
 font-size:4vw;
 color:red;
 text-align:center;
 margin-bottom:20px;
 font-weight:900;
}
.resultsTable{
 width:100%;
 border-collapse:collapse;
 font-size:2.5vw;
 color:red;
}
.resultsTable th, .resultsTable td{
 padding:12px;
 border:2px solid red;
 text-align:center;
 color:red;
}
.resultsTable th{
 background:#ffe6e6;
 color:red;
 font-weight:bold;
}
.resultsTable tr:nth-child(even){
 background:#fff5f5;
}
.exportBtn, .closeResults{
 font-size:2.5vw;
 padding:12px 24px;
 margin:10px;
 background:red;
 color:white;
 border:none;
 cursor:pointer;
 font-weight:bold;
 border-radius:5px;
 box-shadow:0 4px 10px rgba(0,0,0,0.2);
}
.exportBtn:hover, .closeResults:hover{
 background:#cc0000;
 transform:translateY(-2px);
}

/* TIMER */
#timerOverlay{
 position:fixed;
 top:0;
 right:0;
 width:60vw;
 height:100vh;
 background:white;
 display:none;
 flex-direction:column;
 align-items:center;
 justify-content:center;
 border-left:4px solid #00ffd5;
 z-index:100;
 color:red;
}
#timerDisplay{
 font-size:18vw;
 font-weight:900;
 color:red;
 text-shadow:2px 2px 4px rgba(0,0,0,0.5);
 margin-bottom:40px;
}
#timerOverlay button{
 position:absolute;
 bottom:40px;
 left:50%;
 transform:translateX(-50%);
 font-size:3vw;
 padding:15px 30px;
 background:red;
 color:white;
 border:none;
 border-radius:8px;
 font-weight:900;
 cursor:pointer;
 box-shadow:0 4px 15px rgba(0,0,0,0.3);
}

/* TROPHY */
#trophy{
 position:fixed;
 font-size:14vw;
 display:none;
 animation:float 2s infinite alternate;
 z-index:90;
}
@keyframes float{
 from{transform:translate(-50%,-55%)}
 to{transform:translate(-50%,-45%)}
}

/* CONFETTI */
canvas{
 position:fixed;
 top:0;
 left:0;
 pointer-events:none;
 z-index:80;
}
</style>
</head>

<body>

<div class="header">
 <div class="balls">üéæ üéæ üéæ üéæ</div>
 <div>SSR Tennis Tournament 2026</div>
 <div class="balls">üéæ üéæ üéæ üéæ</div>
</div>

<div id="uploadBox" style="text-align:center;padding:6px">
 <input type="file" accept=".xlsx,.csv" onchange="loadFile(this)">
</div>

<div class="main" id="court">

 <div class="team" id="teamA">
  <div class="nameRow">
   <span class="server" id="serveA"></span>
   <div class="name" id="nameA" contenteditable>Team A</div>
  </div>
  <div class="score" id="scoreA" onclick="point('A')">0</div>
  <div class="undo" onclick="undoPoint()">‚ûñ</div>
  <div class="games">Games: <span id="gamesA">0</span></div>
 </div>

 <div class="team" id="teamB">
  <div class="nameRow">
   <span class="server" id="serveB"></span>
   <div class="name" id="nameB" contenteditable>Team B</div>
  </div>
  <div class="score" id="scoreB" onclick="point('B')">0</div>
  <div class="undo" onclick="undoPoint()">‚ûñ</div>
  <div class="games">Games: <span id="gamesB">0</span></div>
 </div>

</div>

<div class="controls">
 <div id="goldenGameBanner">‚ú® FINAL DECIDING GAME ‚ú®</div>
 <button onclick="swapSides()">Swap Sides</button>
 <div class="nextMatch" id="nextMatch"></div>
</div>

<div class="bottomLeft">
 <button onclick="resetMatch()">Reset</button>
 <button onclick="startTimer()">Timer</button>
</div>

<button class="iconBtn resultsIcon" onclick="toggleResults()" title="Results">üìã</button>
<button class="iconBtn nextIcon" onclick="confirmNextMatch()" title="Next Match">‚è≠Ô∏è</button>

<!-- AUDIENCE MODE BUTTON -->
<button class="audienceIcon" id="audienceBtn" onclick="toggleAudienceMode()" title="Audience Mode">üîÑ</button>

<div id="timerOverlay">
 <div id="timerDisplay">45</div>
 <button onclick="stopTimer()">STOP</button>
</div>

<div id="resultsOverlay">
 <div class="resultsHeader">üèÜ Tournament Results</div>
 <table class="resultsTable" id="resultsTable"></table>
 <div style="text-align:center;">
  <button class="exportBtn" onclick="exportResults()">Export Results</button>
  <button class="closeResults" onclick="toggleResults()">Close</button>
 </div>
</div>

<div id="trophy">üèÜ</div>
<canvas id="confetti"></canvas>

<script>
const pts=["0","15","30","40"];
const opp=t=>t==="A"?"B":"A";

let state={pA:0,pB:0,gA:0,gB:0,mode:"NORMAL",adv:null,serve:null};
let history=[];
let matches=[],matchIndex=0;
let results=[];
let audienceMode = false;

/* AUDIENCE MODE TOGGLE */
function toggleAudienceMode(){
 audienceMode = !audienceMode;
 const btn = document.getElementById('audienceBtn');
 btn.classList.toggle('active', audienceMode);
 if(audienceMode){
  // Flip teams for audience mode (laptop scorer sees correct sides, TV sees flipped)
  swapTeamsForDisplay();
 } else {
  // Restore original order
  restoreTeamsForDisplay();
 }
 render();
}

function swapTeamsForDisplay(){
 const court = document.getElementById('court');
 const teamA = document.getElementById('teamA');
 const teamB = document.getElementById('teamB');
 court.insertBefore(teamB, teamA);
}

function restoreTeamsForDisplay(){
 const court = document.getElementById('court');
 const teamA = document.getElementById('teamA');
 const teamB = document.getElementById('teamB');
 court.insertBefore(teamA, teamB);
}

/* POINT */
function point(t){
 history.push(JSON.parse(JSON.stringify(state)));

 if(state.mode==="MATCH_OVER"){
  saveResult();
  stopConfetti();
  loadMatch(matchIndex+1);
  return;
 }

 if(state.mode==="GAME"){nextGame();return;}

 if(state.mode==="NORMAL"){
  if(state.pA===3 && state.pB===3){
   state.mode="ADV";
   state.adv=t;
  }else{
   state["p"+t]++;
   if(state["p"+t]===4){
    state.mode="GAME";
    state.adv=t;
   }
  }
  render();return;
 }

 if(state.mode==="ADV"){
  if(t===state.adv){state.mode="GAME";}
  else{state.mode="GOLDEN";}
  render();return;
 }

 if(state.mode==="GOLDEN"){
  state.mode="GAME";
  state.adv=t;
  render();
 }
}

function nextGame(){
 state["g"+state.adv]++;
 state.pA=state.pB=0;
 state.adv=null;
 state.serve=opp(state.serve);

 if(state.gA===4 && state.gB===4){
  goldenGameBanner.style.display="block";
  state.mode="NORMAL";
 }
 else if(state.gA===5 || state.gB===5){
  state.mode="MATCH_OVER";
  render();
  showWinner();
  return;
 } else state.mode="NORMAL";

 render();
}

/* SAVE RESULT */
function saveResult(){
 if(matchIndex < matches.length){
  let currentMatch = matches[matchIndex];
  results.push({
   time: currentMatch[0],
   teamA: nameA.innerText,
   teamB: nameB.innerText,
   scoreA: state.gA,
   scoreB: state.gB,
   winner: state.gA > state.gB ? nameA.innerText : nameB.innerText
  });
 }
}

/* RENDER */
function render(){
 scoreA.classList.remove("golden");
 scoreB.classList.remove("golden");

 let sa="",sb="";
 if(state.mode==="NORMAL"){sa=pts[state.pA];sb=pts[state.pB];}
 else if(state.mode==="ADV"){
  sa=state.adv==="A"?"Adv":"‚óâ";
  sb=state.adv==="B"?"Adv":"‚óâ";
 }
 else if(state.mode==="GOLDEN"){
  sa=sb="GOLDEN\nPOINT";
  scoreA.classList.add("golden");
  scoreB.classList.add("golden");
 }
 else if(state.mode==="GAME"){
  sa=state.adv==="A"?"GAME":"";
  sb=state.adv==="B"?"GAME":"";
 }

 scoreA.innerText=sa;
 scoreB.innerText=sb;
 gamesA.innerText=state.gA;
 gamesB.innerText=state.gB;

 serveA.innerText=state.serve==="A"?"üéæ":"";
 serveB.innerText=state.serve==="B"?"üéæ":"";

 serveA.classList.toggle("active", state.serve==="A");
 serveB.classList.toggle("active", state.serve==="B");
}

/* UNDO */
function undoPoint(){
 if(history.length===0) return;
 state=history.pop();
 goldenGameBanner.style.display =
  (state.gA===4 && state.gB===4)?"block":"none";
 render();
}

/* ACTUAL RESET FUNCTION (no popup) */
function hardReset(){
 stopConfetti();
 history=[];
 state={pA:0,pB:0,gA:0,gB:0,mode:"NORMAL",adv:null,serve:null};
 teamA.style.display="";
 teamB.style.display="";
 teamA.classList.remove("winner");
 teamB.classList.remove("winner");
 goldenGameBanner.style.display="none";
 if(!audienceMode){
  restoreTeamsForDisplay();
 }
 render();
}

/* RESET BUTTON - ONLY SHOWS POPUP */
function resetMatch(){
 if(confirm("Reset current match? All scores will be lost.")){
  hardReset();
 }
}

/* WINNER */
function showWinner(){
 let w=state.gA>state.gB?"A":"B";
 let l=opp(w);
 document.getElementById("team"+l).style.display="none";
 document.getElementById("score"+w).innerHTML=
  `<span class="winnersText">WINNERS</span>`;
 document.getElementById("team"+w).classList.add("winner");
 trophy.style.display="block";
 let r=document.getElementById("team"+w).getBoundingClientRect();
 trophy.style.left=r.left+r.width/2+"px";
 trophy.style.top=r.top+r.height/2+"px";
 goldenGameBanner.style.display="none";
 startConfetti();
}

/* RESULTS */
function toggleResults(){
 let overlay = document.getElementById("resultsOverlay");
 if(overlay.style.display === "block"){
  overlay.style.display = "none";
 } else {
  renderResults();
  overlay.style.display = "block";
 }
}

function renderResults(){
 let table = document.getElementById("resultsTable");
 let html = `
  <tr>
   <th>Time</th>
   <th>Team A</th>
   <th>Team B</th>
   <th>Score</th>
   <th>Winner</th>
  </tr>
 `;
 results.forEach(r => {
  html += `
   <tr>
    <td>${r.time}</td>
    <td>${r.teamA}</td>
    <td>${r.teamB}</td>
    <td>${r.scoreA}-${r.scoreB}</td>
    <td>${r.winner}</td>
   </tr>
  `;
 });
 table.innerHTML = html;
}

/* EXPORT */
function exportResults(){
 let wb = XLSX.utils.book_new();
 let ws_data = [["Time", "Team A", "Team B", "Score", "Winner"]];
 results.forEach(r => {
  ws_data.push([r.time, r.teamA, r.teamB, `${r.scoreA}-${r.scoreB}`, r.winner]);
 });
 let ws = XLSX.utils.aoa_to_sheet(ws_data);
 XLSX.utils.book_append_sheet(wb, ws, "Results");
 XLSX.writeFile(wb, "SSR_Tennis_Results.xlsx");
}

/* TIMER */
let timerInt;
function startTimer(){
 let sec=parseInt(prompt("Seconds","45"));
 if(!sec)return;
 timerOverlay.style.display="flex";
 timerDisplay.innerText=sec;
 clearInterval(timerInt);
 timerInt=setInterval(()=>{
  sec--;timerDisplay.innerText=sec;
  if(sec<=0)stopTimer();
 },1000);
}
function stopTimer(){
 clearInterval(timerInt);
 timerOverlay.style.display="none";
}

/* CONFETTI */
const c=document.getElementById("confetti");
const ctx=c.getContext("2d");
c.width=innerWidth;c.height=innerHeight;
let confettiInt=null,pieces=[];
function startConfetti(){
 if(confettiInt)return;
 pieces=[...Array(250)].map(()=>({
  x:Math.random()*c.width,
  y:Math.random()*c.height,
  r:Math.random()*6+4,
  d:Math.random()*4+2
 }));
 confettiInt=setInterval(()=>{
  ctx.clearRect(0,0,c.width,c.height);
  pieces.forEach(p=>{
   ctx.fillStyle="gold";
   ctx.beginPath();
   ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
   ctx.fill();
   p.y+=p.d;
   if(p.y>c.height)p.y=-10;
  });
 },30);
}
function stopConfetti(){
 clearInterval(confettiInt);
 confettiInt=null;
 ctx.clearRect(0,0,c.width,c.height);
 trophy.style.display="none";
}

/* LOAD FILE */
function loadFile(input){
 let r=new FileReader();
 r.onload=e=>{
  let wb=XLSX.read(e.target.result,{type:"binary"});
  let rawData=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]],{header:1});
  matches=rawData.slice(1).map(row => {
   let time = row[2];
   if(typeof time === 'number') {
    let hours = Math.floor(time * 24);
    let minutes = Math.floor((time * 24 - hours) * 60);
    time = `${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')} ${hours >= 12 ? 'PM' : 'AM'}`;
   }
   return [time, row[3] || '', row[4] || ''];
  });
  hardReset(); // Use hardReset instead of resetMatch
  loadMatch(0);
  uploadBox.style.display="none";
 };
 r.readAsBinaryString(input.files[0]);
}

function loadMatch(i){
 if(!matches[i])return;
 matchIndex=i;
 hardReset(); // Use hardReset instead of resetMatch
 nameA.innerText=matches[i][1];
 nameB.innerText=matches[i][2];
 nextMatch.innerText=matches[i+1]
  ?`NEXT MATCH ‚Äì ${matches[i+1][0]} | ${matches[i+1][1]} vs ${matches[i+1][2]}`
  :"NO MORE MATCHES";
}

function confirmNextMatch(){
 if(confirm("Load next match? Current match will be reset.")){
  stopConfetti();
  loadMatch(matchIndex+1);
 }
}

function swapSides(){
 let c=document.getElementById("court");
 c.insertBefore(c.children[1],c.children[0]);
}

nameA.onclick=()=>{if(!state.serve){state.serve="A";render();}}
nameB.onclick=()=>{if(!state.serve){state.serve="B";render();}}

render();
</script>
</body>
</html>
